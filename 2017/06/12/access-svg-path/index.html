<!DOCTYPE html><html lang="zh-tw"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>取得svg裡的path節點 | 歷史共業</title><meta name="description" content="取得svg裡的path節點 - Ronnie Chang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/blog/atom.xml" title="歷史共業"></head><body><div class="wrap"><header><h1 class="branding"><a href="/blog/" title="歷史共業"><img class="logo-image" src="/blog/logo.png" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/blog/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/blog/archives/" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="/blog/tags/" target="_self">TAGS</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://yuugou727.github.io/" target="_blank">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/blog/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">取得svg裡的path節點</h1><div class="post-info"><a></a>2017-06-12<span class="categories"><a class="post-category" href="/blog/categories/前端筆記/">前端筆記</a></span><ul class="tags"><li><a class="post-tag" href="/blog/tags/JavaScript/">JavaScript</a></li><li><a class="post-tag" href="/blog/tags/svg/">svg</a></li></ul></div><div class="post-content"><p>網頁中使用<code>&lt;object&gt;</code> tag 載入 svg 檔案的寫法長這樣:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">type</span>=<span class="string">"image/svg+xml"</span> <span class="attr">data</span>=<span class="string">"myFile.svg"</span> <span class="attr">id</span>=<span class="string">"myObj"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果我們想用 JS 取得 svg 裡的<code>&lt;path&gt;</code> 節點呢?<br><a id="more"></a><br>首先，<code>&lt;object&gt;&lt;/object&gt;</code>裡的 svg 檔案是在 html 被解析完才載入的， 所以必須寫在這個 object 的 load 事件:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObj = <span class="built_in">document</span>.getElementById(<span class="string">'myObj'</span>); </span><br><span class="line">    myObj.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>那再來就是用<code>getElemetsByTagName()</code>去抓 path 嘛? 如果這麼單純我就不會寫這篇筆記了…<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObj = <span class="built_in">document</span>.getElementById(<span class="string">'myObj'</span>); </span><br><span class="line">    myObj.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> paths = myObj.getElementsByTagName(<span class="string">'path'</span>); </span><br><span class="line">        <span class="built_in">console</span>.log(paths); <span class="comment">// []</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<img src="https://media.giphy.com/media/GdWZJHPjYmDTy/giphy.gif">
<p>結果抓到的是<strong>空陣列</strong>，怎麼會這樣?</p>
<p>用 Chrome devTool 檢查網頁結構，發現在<code>&lt;object&gt;&lt;/object&gt;</code>tag 中，與 <code>&lt;svg&gt;&lt;/svg&gt;</code>tag還隔著一層<code>#document</code>wrap像這樣:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">type</span>=<span class="string">"image/svg+xml"</span> <span class="attr">data</span>=<span class="string">"myFile.svg"</span> <span class="attr">id</span>=<span class="string">"myObj"</span>&gt;</span></span><br><span class="line">    #document</span><br><span class="line">        <span class="tag">&lt;<span class="name">svg</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>就是因為中間那層 document ，object 還需要透過 <strong><code>contentDocument</code></strong> 屬性才能訪問其中的節點:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObj = <span class="built_in">document</span>.getElementById(<span class="string">'myObj'</span>); </span><br><span class="line">    myObj.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> paths = myObj.contentDocument.getElementsByTagName(<span class="string">'path'</span>); </span><br><span class="line">        <span class="built_in">console</span>.log(paths); <span class="comment">// (N) [path#A, path#B , ...]</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如此便能成功獲取我們要的 path ，可喜可賀。 </p>
<h3 id="靠北的有趣的地方"><a href="#靠北的有趣的地方" class="headerlink" title="靠北的有趣的地方"></a><del>靠北的</del>有趣的地方</h3><p>如果我們重新整理頁面，在 console 直接輸入 <code>document.getElementsByTagName(&#39;path&#39;)</code> 也是傳回空陣列；但如果滑鼠右鍵直接點在我們的 svg 上檢查 ，再重新輸入一次 <code>document.getElementsByTagName(&#39;path&#39;)</code> 卻能正確回傳所有的 path 節點陣列。</p>
<h3 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h3><p>就是一個 window 裡有多個 document 的概念，跟 iframe 有九成像， document 還會隨著 client scope 而變，依靠 document 並不是好的抓取 svg 方式。</p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/blog/2017/06/15/webpack-bootstrap-4/">上一篇</a><a class="next" href="/blog/2017/05/28/access-web-OS/">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'yuugou727';
var disqus_config = function () {
    this.page.url = 'https://yuugou727.github.io/blog/2017/06/12/access-svg-path/';
    this.page.identifier = '2017/06/12/access-svg-path/';
};
(function() {
    var d = document, s = d.createElement('script');
    s.src = '//' + disqus_shortname  + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', + new Date());
    (d.head || d.body).appendChild(s);
})();</script><div class="copyright"><p>&copy; 2017 - 2018 <a href="https://yuugou727.github.io/">Ronnie Chang</a>.<br>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/yuugou727/hexo-theme-artemis-night" target="_blank">Artemis Night</a>.</p></div></footer></div><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-104625762-1']);
_gaq.push(['_trackPageview']);

(function () {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>